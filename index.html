<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lesson Plan Generator</title>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QNLC3X2JSH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-QNLC3X2JSH');
</script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2536391720214541"
     crossorigin="anonymous"></script>
  <!-- ‚úÖ PRE-LOAD HTML2PDF.JS TO FIX BLANK PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600&family=Times+New+Roman&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Montserrat', sans-serif;
      margin: 0;
      background: linear-gradient(135deg, #173b6c, #2a5ca8);
      color: #333;
      min-height: 100vh;
    }
    .container {
      max-width: 1100px;
      margin: 20px auto;
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
      overflow: hidden;
      position: relative;
    }
    /* Header with Logo Only (Left-Aligned) */
    header {
      display: flex;
      align-items: center;
      background: #ffffff;
      padding: 12px 20px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      border-radius: 14px 14px 0 0;
      border-bottom: 3px solid #0d264d;
    }
    .form-section {
      padding: 25px;
      position: relative;
    }
    .compact-row, .wide-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 18px;
    }
    .compact-group { flex: 1 1 120px; }
    .wide-group { flex: 1 1 48%; }
    .full-group { flex: 1 1 100%; }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: #1a3c6e;
      font-size: 10pt;
    }
    input, textarea, select {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 10pt;
      font-family: 'Times New Roman', Times, serif;
    }
    .compact-group input, .compact-group select { height: 32px; font-size: 10pt; }
    .wide-group textarea, .full-group textarea { min-height: 50px; font-size: 10pt; }
    .full-group textarea { min-height: 80px; font-size: 10pt; }
    input:focus, textarea:focus, select:focus {
      border-color: #1a3c6e;
      outline: none;
    }
    .button-group {
      display: flex;
      justify-content: center;
      gap: 14px;
      margin: 25px 0 15px;
      flex-wrap: wrap;
    }
    button {
      padding: 10px 20px;
      font-size: 10pt;
      font-weight: bold;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    #generateBtn { background-color: #0056b3; color: white; }
    #printBtn { background-color: #007bff; color: white; }
    #downloadPdfBtn { background-color: #6f42c1; color: white; }
    #saveBtn { background-color: #28a745; color: white; }
    #loadBtn { background-color: #fd7e14; color: white; }
    #clearBtn { background-color: #dc3545; color: white; }
    button:hover {
      opacity: 0.9;
      transform: translateY(-2px);
    }
    /* LOADING INDICATOR - Bottom Right */
    #loader {
      position: absolute;
      bottom: 20px;
      right: 30px;
      width: 30px;
      height: 30px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #007bff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      display: none;
      z-index: 100;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    #lessonPlanOutput {
      display: none;
      padding: 0;
    }
    /* === PRINT & PDF OPTIMIZED A4 SINGLE PAGE LAYOUT === */
    @media print {
      @page {
        size: A4 portrait;
        margin: 0.6cm;
      }
      body {
        background: white !important;
        margin: 0;
        padding: 0;
        width: 100%;
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
      }
      .container {
        width: 100% !important;
        max-width: 210mm;
        height: auto !important;
        margin: 0 auto;
        padding: 0;
        box-shadow: none !important;
        border: none !important;
        transform: scale(0.95);
        transform-origin: top center;
      }
      #lessonPlanOutput {
        display: block !important;
        width: 100% !important;
        height: auto !important;
        overflow: visible !important;
      }
      table.lesson-table {
        width: 100% !important;
        border-collapse: collapse;
        font-family: 'Times New Roman', Times, serif;
        font-size: 9pt;
        border: 1pt solid black;
      }
      .lesson-table th,
      .lesson-table td {
        border: 1pt solid black;
        padding: 4pt;
        line-height: 1.3;
        vertical-align: top;
        word-wrap: break-word;
      }
      .lesson-table th {
        background-color: #e6f0ff !important;
        font-weight: bold;
        text-align: center;
      }
      .lesson-table .day-header { width: 7%; }
      .lesson-table .starter { width: 12%; }
      .lesson-table .main { width: 61%; }
      .lesson-table .reflection { width: 20%; }
      tr, td, table {
        page-break-inside: auto !important;
      }
    }
    @media print {
      .no-print {
        display: none !important;
      }
    }
    /* Welcome Page Styles */
    #welcomePage {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      position: relative;
      background: linear-gradient(135deg, #6c75ff, #7a4aff);
      color: white;
      text-align: center;
      padding: 20px;
      box-sizing: border-box;
    }
    #welcomePage .logo-container img {
      height: 300px;
      width: auto;
      filter: drop-shadow(0 4px 6px rgba(0,0,0,0.2));
    }
    #welcomePage h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      font-weight: 700;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    #welcomePage p {
      font-size: 1.2rem;
      margin-bottom: 25px;
      font-weight: 400;
      opacity: 0.9;
    }
    #welcomePage button {
      padding: 12px 30px;
      font-size: 1.1rem;
      font-weight: 600;
      background-color: white;
      color: #6c75ff;
      border: 2px solid #6c75ff;
      border-radius: 30px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    #welcomePage button:hover {
      background-color: #6c75ff;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }
    #mainApp { display: none; }
    .global-footer {
      text-align: center;
      padding: 15px;
      color: #0056b3;
      font-size: 0.9rem;
      margin-top: auto;
      width: 100%;
      background-color: white;
    }
    @media print {
      nav {
        display: none !important;
      }
    }
  </style>
</head>
<body>
  <nav style="background:#173b6c; padding:15px; text-align:center;">
    <a href="index.html" style="color:white; text-decoration:none; margin:0 15px;">Home</a>
    <a href="about.html" style="color:white; text-decoration:none; margin:0 15px;">About</a>
    <a href="privacy.html" style="color:white; text-decoration:none; margin:0 15px;">Privacy Policy</a>
    <a href="contact.html" style="color:white; text-decoration:none; margin:0 15px;">Contact</a>
  </nav>
  
  <div id="welcomePage">
    <div class="logo-container">
      <img src="Logo.png" alt="Logo" style="height: 300px; width: auto;" onerror="this.style.display='none'">
    </div>
    <h1>Welcome, Facilitator!</h1>
    <p>click the button Below to begin!</p>
    <button id="startButton">Generate Plan</button>
  </div>

  <div id="mainApp">
    <div class="container">
      <header id="appHeader" class="no-print"></header>
      <div class="form-section no-print">
        <div class="compact-row">
          <div class="compact-group">
            <label>Class</label>
            <select id="class" required>
              <option value="">Select Class</option>
              <option value="K/G 1">K/G 1</option>
              <option value="K/G 2">K/G 2</option>
              <option value="Basic 1">Basic 1</option>
              <option value="Basic 2">Basic 2</option>
              <option value="Basic 3">Basic 3</option>
              <option value="Basic 4">Basic 4</option>
              <option value="Basic 5">Basic 5</option>
              <option value="Basic 6">Basic 6</option>
              <option value="Basic 7">Basic 7</option>
              <option value="Basic 8">Basic 8</option>
              <option value="Basic 9">Basic 9</option>
            </select>
          </div>
          <div class="compact-group">
            <label>Subject</label>
            <select id="subject" required>
              <option value="">Select Subject</option>
            </select>
          </div>
          <div class="compact-group">
            <label>Week Number</label>
            <select id="weekNum" required>
              <option value="">Select Week</option>
              <option value="1">Week 1</option>
              <option value="2">Week 2</option>
              <option value="3">Week 3</option>
              <option value="4">Week 4</option>
              <option value="5">Week 5</option>
              <option value="6">Week 6</option>
              <option value="7">Week 7</option>
              <option value="8">Week 8</option>
              <option value="9">Week 9</option>
              <option value="10">Week 10</option>
              <option value="11">Week 11</option>
              <option value="12">Week 12</option>
              <option value="13">Week 13</option>
              <option value="14">Week 14</option>
              <option value="15">Week 15</option>
              <option value="16">Week 16</option>
              <option value="17">Week 17</option>
              <option value="18">Week 18</option>
              <option value="19">Week 19</option>
              <option value="20">Week 20</option>
            </select>
          </div>
          <div class="compact-group">
            <label>Date</label>
            <input type="text" id="date" placeholder="12/04" />
          </div>
          <div class="compact-group">
            <label>Week Ending</label>
            <input type="text" id="weekEnding" placeholder="12/08" />
          </div>
          <div class="compact-group">
            <label>Day</label>
            <select id="day" required>
              <option value="">Select Day</option>
              <option value="Monday">Monday</option>
              <option value="Tuesday">Tuesday</option>
              <option value="Wednesday">Wednesday</option>
              <option value="Thursday">Thursday</option>
              <option value="Friday">Friday</option>
            </select>
          </div>
        </div>
        <div class="compact-row">
          <div class="compact-group">
            <label>Lesson</label>
            <input type="text" id="lessonTitle" />
          </div>
          <div class="compact-group">
            <label>Period</label>
            <input type="text" id="period" />
          </div>
          <div class="compact-group">
            <label>Class Size</label>
            <input type="number" id="classSize" />
          </div>
          <div class="compact-group">
            <label>Duration</label>
            <input type="text" id="duration" value="40 mins" />
          </div>
        </div>
        <div class="wide-row">
          <div class="wide-group">
            <label>Strand</label>
            <textarea id="strand" rows="2"></textarea>
          </div>
          <div class="wide-group">
            <label>Sub-strand</label>
            <textarea id="subStrand" rows="2"></textarea>
          </div>
        </div>
        <div class="wide-row">
          <div class="wide-group">
            <label>Content Standard</label>
            <textarea id="contentStandard" rows="2"></textarea>
          </div>
          <div class="wide-group">
            <label>Indicator</label>
            <input type="text" id="indicator" />
          </div>
        </div>
        <div class="wide-row">
          <div class="full-group">
            <label>Performance Indicator</label>
            <textarea id="performanceIndicator" rows="3"></textarea>
          </div>
        </div>
        <div class="wide-row">
          <div class="full-group">
            <label>Core Competencies</label>
            <textarea id="coreCompetencies" rows="3"></textarea>
          </div>
        </div>
        <div class="wide-row">
          <div class="full-group">
            <label>Keywords</label>
            <textarea id="keywords" rows="2"></textarea>
          </div>
        </div>
        <div class="wide-row">
          <div class="full-group">
            <label>Exemplars</label>
            <textarea id="exemplars" rows="4" placeholder="1. Explain electronic spreadsheet to the learners.
2. Guide learners to identify 2 examples of electronic spreadsheet.
3. Explain the steps involved in launching MS Excel.
4. Discuss 2 importance of MS Excel with the learners."></textarea>
          </div>
        </div>
        <div class="wide-row">
          <div class="wide-group">
            <label>T/L Resources</label>
            <textarea id="tlrs" rows="2" placeholder="Computer with MS Excel, Projector"></textarea>
          </div>
          <div class="wide-group">
            <label>References</label>
            <textarea id="references" rows="2"></textarea>
          </div>
        </div>
        <div class="wide-row">
          <div class="full-group">
           <label>District / Municipal / Metropolitan</label>
            <select id="district" required>
              <option value="" disabled selected>Select your district</option>
              <optgroup label="Ahafo Region">
                <option value="Asutifi North Municipal">Asutifi North Municipal</option>
                <option value="Asutifi South District">Asutifi South District</option>
                <option value="Asunafo North Municipal">Asunafo North Municipal</option>
                <option value="Asunafo South District">Asunafo South District</option>
                <option value="Tano North Municipal">Tano North Municipal</option>
                <option value="Tano South Municipal">Tano South Municipal</option>
              </optgroup>
              <optgroup label="Ashanti Region">
                <option value="Adansi Asokwa District">Adansi Asokwa District</option>
                <option value="Adansi North District">Adansi North District</option>
                <option value="Adansi South District">Adansi South District</option>
                <option value="Afigya Kwabre North District">Afigya Kwabre North District</option>
                <option value="Afigya Kwabre South District">Afigya Kwabre South District</option>
                <option value="Akrofuom District">Akrofuom District</option>
                <option value="Amansie Central District">Amansie Central District</option>
                <option value="Amansie South District">Amansie South District</option>
                <option value="Amansie West District">Amansie West District</option>
                <option value="Asante Akim Central Municipal">Asante Akim Central Municipal</option>
                <option value="Asante Akim North Municipal">Asante Akim North Municipal</option>
                <option value="Asante Akim South Municipal">Asante Akim South Municipal</option>
                <option value="Asokore Mampong Municipal">Asokore Mampong Municipal</option>
                <option value="Asokwa Municipal">Asokwa Municipal</option>
                <option value="Atwima Kwanwoma District">Atwima Kwanwoma District</option>
                <option value="Atwima Mponua District">Atwima Mponua District</option>
                <option value="Atwima Nwabiagya Municipal">Atwima Nwabiagya Municipal</option>
                <option value="Atwima Nwabiagya North District">Atwima Nwabiagya North District</option>
                <option value="Bantama Municipal">Bantama Municipal</option>
                <option value="Ejisu Municipal">Ejisu Municipal</option>
                <option value="Ejura Sekyedumase Municipal">Ejura Sekyedumase Municipal</option>
                <option value="Juaben Municipal">Juaben Municipal</option>
                <option value="Kumasi Metropolitan">Kumasi Metropolitan</option>
                <option value="Kwabre East Municipal">Kwabre East Municipal</option>
                <option value="Mampong Municipal">Mampong Municipal</option>
                <option value="Obuasi Municipal">Obuasi Municipal</option>
                <option value="Obuasi East District">Obuasi East District</option>
                <option value="Offinso Municipal">Offinso Municipal</option>
                <option value="Offinso North District">Offinso North District</option>
                <option value="Oforikrom Municipal">Oforikrom Municipal</option>
                <option value="Old Tafo Municipal">Old Tafo Municipal</option>
                <option value="Sekyere Central District">Sekyere Central District</option>
                <option value="Sekyere East District">Sekyere East District</option>
                <option value="Sekyere Kumawu District">Sekyere Kumawu District</option>
                <option value="Sekyere South District">Sekyere South District</option>
                <option value="Suame Municipal">Suame Municipal</option>
              </optgroup>
              <optgroup label="Bono Region">
                <option value="Berekum Municipal">Berekum Municipal</option>
                <option value="Berekum West District">Berekum West District</option>
                <option value="Dormaa Central Municipal">Dormaa Central Municipal</option>
                <option value="Dormaa East District">Dormaa East District</option>
                <option value="Dormaa West District">Dormaa West District</option>
                <option value="Jaman North District">Jaman North District</option>
                <option value="Jaman South Municipal">Jaman South Municipal</option>
                <option value="Sunyani Municipal">Sunyani Municipal</option>
                <option value="Sunyani West District">Sunyani West District</option>
              </optgroup>
              <optgroup label="Bono East Region">
                <option value="Atebubu-Amantin Municipal">Atebubu-Amantin Municipal</option>
                <option value="Kintampo North Municipal">Kintampo North Municipal</option>
                <option value="Kintampo South District">Kintampo South District</option>
                <option value="Nkoranza North District">Nkoranza North District</option>
                <option value="Nkoranza South Municipal">Nkoranza South Municipal</option>
                <option value="Pru East District">Pru East District</option>
                <option value="Pru West District">Pru West District</option>
                <option value="Sene East District">Sene East District</option>
                <option value="Sene West District">Sene West District</option>
                <option value="Techiman Municipal">Techiman Municipal</option>
                <option value="Techiman North District">Techiman North District</option>
              </optgroup>
              <optgroup label="Central Region">
                <option value="Abura/Asebu/Kwamankese District">Abura/Asebu/Kwamankese District</option>
                <option value="Agona East District">Agona East District</option>
                <option value="Agona West Municipal">Agona West Municipal</option>
                <option value="Ajumako Enyan Esiam District">Ajumako Enyan Esiam District</option>
                <option value="Asikuma Odoben Brakwa District">Asikuma Odoben Brakwa District</option>
                <option value="Assin Central Municipal">Assin Central Municipal</option>
                <option value="Assin North District">Assin North District</option>
                <option value="Awutu Senya District">Awutu Senya District</option>
                <option value="Awutu Senya East Municipal">Awutu Senya East Municipal</option>
                <option value="Ekumfi District">Ekumfi District</option>
                <option value="Gomoa East District">Gomoa East District</option>
                <option value="Gomoa West District">Gomoa West District</option>
                <option value="Mfantsiman Municipal">Mfantsiman Municipal</option>
                <option value="Twifo Hemang Lower Denkyira District">Twifo Hemang Lower Denkyira District</option>
                <option value="Upper Denkyira East Municipal">Upper Denkyira East Municipal</option>
                <option value="Upper Denkyira West District">Upper Denkyira West District</option>
                <option value="Cape Coast Metropolitan">Cape Coast Metropolitan</option>
                <option value="Effutu Municipal">Effutu Municipal</option>
                <option value="Komenda Edina Eguafo Abirem Municipal">Komenda Edina Eguafo Abirem Municipal</option>
              </optgroup>
              <optgroup label="Eastern Region">
                <option value="Akuapim North Municipal">Akuapim North Municipal</option>
                <option value="Akuapim South District">Akuapim South District</option>
                <option value="Akuapim Central District">Akuapim Central District</option>
                <option value="Akyemansa District">Akyemansa District</option>
                <option value="Asene Manso Akropong District">Asene Manso Akropong District</option>
                <option value="Atiwa East District">Atiwa East District</option>
                <option value="Atiwa West District">Atiwa West District</option>
                <option value="Ayensuano District">Ayensuano District</option>
                <option value="Fanteakwa North District">Fanteakwa North District</option>
                <option value="Fanteakwa South District">Fanteakwa South District</option>
                <option value="Kwaebibirem Municipal">Kwaebibirem Municipal</option>
                <option value="Kwahu Afram Plains North District">Kwahu Afram Plains North District</option>
                <option value="Kwahu Afram Plains South District">Kwahu Afram Plains South District</option>
                <option value="Kwahu East District">Kwahu East District</option>
                <option value="Kwahu South District">Kwahu South District</option>
                <option value="Kwahu West Municipal">Kwahu West Municipal</option>
                <option value="Lower Manya Krobo Municipal">Lower Manya Krobo Municipal</option>
                <option value="New Juaben North District">New Juaben North District</option>
                <option value="New Juaben South Municipal">New Juaben South Municipal</option>
                <option value="Nsawam Adoagyiri Municipal">Nsawam Adoagyiri Municipal</option>
                <option value="Suhum Municipal">Suhum Municipal</option>
                <option value="Upper Manya Krobo Municipal">Upper Manya Krobo Municipal</option>
                <option value="West Akim Municipal">West Akim Municipal</option>
                <option value="East Akim Municipal">East Akim Municipal</option>
                <option value="Yilo Krobo Municipal">Yilo Krobo Municipal</option>
              </optgroup>
              <optgroup label="Greater Accra Region">
                <option value="Accra Metropolitan">Accra Metropolitan</option>
                <option value="Adentan Municipal">Adentan Municipal</option>
                <option value="Ashaiman Municipal">Ashaiman Municipal</option>
                <option value="Ablekuma North Municipal">Ablekuma North Municipal</option>
                <option value="Ablekuma South Municipal">Ablekuma South Municipal</option>
                <option value="Ayawaso Central Municipal">Ayawaso Central Municipal</option>
                <option value="Ayawaso East Municipal">Ayawaso East Municipal</option>
                <option value="Ayawaso West Municipal">Ayawaso West Municipal</option>
                <option value="Ga Central Municipal">Ga Central Municipal</option>
                <option value="Ga South Municipal">Ga South Municipal</option>
                <option value="Ga East Municipal">Ga East Municipal</option>
                <option value="Ga West Municipal">Ga West Municipal</option>
                <option value="Korle-Klottey Municipal">Korle-Klottey Municipal</option>
                <option value="Kwashieman Municipal">Kwashieman Municipal</option>
                <option value="Okaikwei North Municipal">Okaikwei North Municipal</option>
                <option value="Tema Metropolitan">Tema Metropolitan</option>
                <option value="Tema West Municipal">Tema West Municipal</option>
                <option value="Ledzokuku Municipal">Ledzokuku Municipal</option>
                <option value="La Dadekotopon Municipal">La Dadekotopon Municipal</option>
                <option value="La Nkwantanang Madina Municipal">La Nkwantanang Madina Municipal</option>
                <option value="Shai Osudoku District">Shai Osudoku District</option>
                <option value="Ningo Prampram District">Ningo Prampram District</option>
                <option value="Kpone Katamanso District">Kpone Katamanso District</option>
                <option value="Weija Gbawe Municipal">Weija Gbawe Municipal</option>
                <option value="Abokobi-Madina District">Abokobi-Madina District</option>
              </optgroup>
              <optgroup label="Northern Region">
                <option value="Bole District">Bole District</option>
                <option value="Central Gonja District">Central Gonja District</option>
                <option value="Chereponi District">Chereponi District</option>
                <option value="East Gonja Municipal">East Gonja Municipal</option>
                <option value="Gushegu Municipal">Gushegu Municipal</option>
                <option value="Karaga District">Karaga District</option>
                <option value="Kpandai District">Kpandai District</option>
                <option value="Mion District">Mion District</option>
                <option value="Nanumba North Municipal">Nanumba North Municipal</option>
                <option value="Nanumba South District">Nanumba South District</option>
                <option value="Saboba District">Saboba District</option>
                <option value="Savelugu Municipal">Savelugu Municipal</option>
                <option value="Sawla Tuna Kalba District">Sawla Tuna Kalba District</option>
                <option value="Tatale Sanguli District">Tatale Sanguli District</option>
                <option value="Tolon District">Tolon District</option>
                <option value="Zabzugu District">Zabzugu District</option>
                <option value="Yendi Municipal">Yendi Municipal</option>
                <option value="Sagnarigu Municipal">Sagnarigu Municipal</option>
                <option value="Tamale Metropolitan">Tamale Metropolitan</option>
              </optgroup>
              <optgroup label="North East Region">
                <option value="Bunkpurugu Nyankpanduri District">Bunkpurugu Nyankpanduri District</option>
                <option value="Chereponi District">Chereponi District</option>
                <option value="East Mamprusi Municipal">East Mamprusi Municipal</option>
                <option value="Gambaga District">Gambaga District</option>
                <option value="Mamprugu Moagduri District">Mamprugu Moagduri District</option>
                <option value="West Mamprusi Municipal">West Mamprusi Municipal</option>
              </optgroup>
              <optgroup label="Oti Region">
                <option value="Jasikan District">Jasikan District</option>
                <option value="Kadjebi District">Kadjebi District</option>
                <option value="Nkwanta North Municipal">Nkwanta North Municipal</option>
                <option value="Nkwanta South Municipal">Nkwanta South Municipal</option>
                <option value="Biakoye District">Biakoye District</option>
                <option value="Guan District">Guan District</option>
                <option value="Krachi East Municipal">Krachi East Municipal</option>
                <option value="Krachi Nchumuru District">Krachi Nchumuru District</option>
                <option value="Krachi West District">Krachi West District</option>
              </optgroup>
              <optgroup label="Savannah Region">
                <option value="Bole District">Bole District</option>
                <option value="Central Gonja District">Central Gonja District</option>
                <option value="North Gonja District">North Gonja District</option>
                <option value="Sawla Tuna Kalba District">Sawla Tuna Kalba District</option>
                <option value="St. Martin's District">St. Martin's District</option>
                <option value="East Gonja Municipal">East Gonja Municipal</option>
              </optgroup>
              <optgroup label="Upper East Region">
                <option value="Bawku Municipal">Bawku Municipal</option>
                <option value="Bawku West District">Bawku West District</option>
                <option value="Bolgatanga East District">Bolgatanga East District</option>
                <option value="Bolgatanga Municipal">Bolgatanga Municipal</option>
                <option value="Builsa North District">Builsa North District</option>
                <option value="Builsa South District">Builsa South District</option>
                <option value="Garu District">Garu District</option>
                <option value="Kassena Nankana East Municipal">Kassena Nankana East Municipal</option>
                <option value="Kassena Nankana West District">Kassena Nankana West District</option>
                <option value="Tempane District">Tempane District</option>
                <option value="Zebilla District">Zebilla District</option>
                <option value="Binduri District">Binduri District</option>
                <option value="Nabdam District">Nabdam District</option>
              </optgroup>
              <optgroup label="Upper West Region">
                <option value="Daffiama Bussie Issa District">Daffiama Bussie Issa District</option>
                <option value="Jirapa Municipal">Jirapa Municipal</option>
                <option value="Lambussie District">Lambussie District</option>
                <option value="Lawra Municipal">Lawra Municipal</option>
                <option value="Nandom Municipal">Nandom Municipal</option>
                <option value="Sissala East Municipal">Sissala East Municipal</option>
                <option value="Sissala West District">Sissala West District</option>
                <option value="Wa East District">Wa East District</option>
                <option value="Wa Municipal">Wa Municipal</option>
                <option value="Wa West District">Wa West District</option>
              </optgroup>
              <optgroup label="Western Region">
                <option value="Ahanta West Municipal">Ahanta West Municipal</option>
                <option value="Ellembelle District">Ellembelle District</option>
                <option value="Jomoro Municipal">Jomoro Municipal</option>
                <option value="Mpohor District">Mpohor District</option>
                <option value="Nzema East Municipal">Nzema East Municipal</option>
                <option value="Prestea Huni Valley Municipal">Prestea Huni Valley Municipal</option>
                <option value="Shama District">Shama District</option>
                <option value="Tarkwa Nsuaem Municipal">Tarkwa Nsuaem Municipal</option>
                <option value="Wassa Amenfi Central Municipal">Wassa Amenfi Central Municipal</option>
                <option value="Wassa Amenfi East District">Wassa Amenfi East District</option>
                <option value="Wassa Amenfi West District">Wassa Amenfi West District</option>
                <option value="Wassa East District">Wassa East District</option>
              </optgroup>
              <optgroup label="Western North Region">
                <option value="Bia East District">Bia East District</option>
                <option value="Bia West District">Bia West District</option>
                <option value="Bibiani Anhwiaso Bekwai Municipal">Bibiani Anhwiaso Bekwai Municipal</option>
                <option value="Juaboso District">Juaboso District</option>
                <option value="Sefwi Akontombra District">Sefwi Akontombra District</option>
                <option value="Sefwi Wiawso Municipal">Sefwi Wiawso Municipal</option>
                <option value="Suaman District">Suaman District</option>
              </optgroup>
              <optgroup label="Volta Region">
                <option value="Ada East District">Ada East District</option>
                <option value="Ada West District">Ada West District</option>
                <option value="Afadzato South District">Afadzato South District</option>
                <option value="Agotime Ziope District">Agotime Ziope District</option>
                <option value="Akatsi North District">Akatsi North District</option>
                <option value="Akatsi South District">Akatsi South District</option>
                <option value="Central Tongu District">Central Tongu District</option>
                <option value="Ho Municipal">Ho Municipal</option>
                <option value="Hohoe Municipal">Hohoe Municipal</option>
                <option value="Keta Municipal">Keta Municipal</option>
                <option value="Ketu North District">Ketu North District</option>
                <option value="Ketu South Municipal">Ketu South Municipal</option>
                <option value="North Dayi District">North Dayi District</option>
                <option value="North Tongu District">North Tongu District</option>
                <option value="South Dayi District">South Dayi District</option>
                <option value="South Tongu District">South Tongu District</option>
                <option value="Kpando Municipal">Kpando Municipal</option>
                <option value="Anfoega District">Anfoega District</option>
                <option value="Biakoye District">Biakoye District</option>
              </optgroup>
            </select>
          </div>
        </div>
        <div class="button-group">
          <button id="generateBtn" onclick="generateLessonPlan()">Generate Plan</button>
          <button id="printBtn" onclick="printPlan()">Print Plan</button>
          <button id="downloadPdfBtn" onclick="downloadAsPDF()">Download PDF</button>
          <button id="saveBtn" onclick="savePlan()">Save Plan</button>
          <button id="loadBtn" onclick="loadLastPlan()">Load Last Plan</button>
          <button id="clearBtn" onclick="clearForm()">Clear Form</button>
        </div>
        <div id="loader"></div>
      </div>
      <div id="lessonPlanOutput">
        <table class="lesson-table">
          <tr>
            <th colspan="11" style="font-size:14pt;">
              <strong><span id="outputDistrictHeader">WEEKLY LESSON PLAN</span></strong>
            </th>
          </tr>
          <tr>
            <th colspan="11"><span id="outputClass"></span></th>
          </tr>
          <tr>
            <th colspan="11">WEEK <span id="outputWeekNum"></span></th>
          </tr>
          <tr>
            <td colspan="2"><strong>Class size:</strong> <span id="outputClassSize"></span></td>
            <td colspan="2"><strong>Duration:</strong> <span id="outputDuration"></span></td>
            <td colspan="2"><strong>TLRs:</strong> <span id="outputTlrs"></span></td>
            <td colspan="2"><strong>Date:</strong> <span id="outputDate"></span></td>
            <td colspan="3"><strong>Week Ending:</strong> <span id="outputWeekEnding"></span></td>
          </tr>
          <tr>
            <td colspan="2"><strong>Lesson:</strong> <span id="outputLessonTitle"></span></td>
            <td colspan="2"><strong>Day:</strong> <span id="outputDayInHeader"></span></td>
            <td colspan="7"><strong>Reference:</strong> <span id="outputReferences"></span></td>
          </tr>
          <tr>
            <td colspan="4"><strong>Strand:</strong> <span id="outputStrand"></span></td>
            <td colspan="7"><strong>Sub-strand:</strong> <span id="outputSubStrand"></span></td>
          </tr>
          <tr>
            <td colspan="4"><strong>Content standard:</strong> <span id="outputContentStandard"></span></td>
            <td colspan="7"><strong>Indicator:</strong> <span id="outputIndicator"></span></td>
          </tr>
          <tr>
            <td colspan="11"><strong>Performance Indicator:</strong> <span id="outputPerformanceIndicator"></span></td>
          </tr>
          <tr>
            <td colspan="11"><strong>Core Competencies:</strong> <span id="outputCoreCompetencies"></span></td>
          </tr>
          <tr>
            <th class="day-header">DAY</th>
            <th class="starter">PHASE 1/<br>STARTER</th>
            <th colspan="7" class="main">PHASE 2 / MAIN</th>
            <th colspan="2" class="reflection">PHASE 3 / REFLECTION</th>
          </tr>
          <tr>
            <td><span id="outputDayInTable"></span></td>
            <td class="content"><div id="outputStarter"></div></td>
            <td colspan="7" class="content"><div id="outputMainActivities"></div></td>
            <td colspan="2" class="content"><div id="outputReflection"></div></td>
          </tr>
        </table>
      </div>
    </div>
  </div>

  <div class="global-footer">
    ¬© 2025 Klint Lesson Plan Generator. All Rights Reserved.
  </div>

  <script>
    // üåü DOM-ready for welcome button
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('startButton').addEventListener('click', () => {
        document.getElementById('welcomePage').style.display = 'none';
        document.getElementById('mainApp').style.display = 'block';
      });
    });

    // üîÅ SUBJECT OPTIONS BY CLASS
    const SUBJECTS_BY_CLASS = {
      'K/G 1': ['Language and Literacy', 'Numeracy', 'Creative Arts', 'Our World Our People'],
      'K/G 2': ['Language and Literacy', 'Numeracy', 'Creative Arts', 'Our World Our People'],
      'Basic 1': ['Our World Our People', 'History', 'English Language', 'Mathematics', 'Science', 'Ghanian Language', 'Creative Arts & Design'],
      'Basic 2': ['Our World Our People', 'History', 'English Language', 'Mathematics', 'Science', 'Ghanian Language', 'Creative Arts & Design'],
      'Basic 3': ['Our World Our People', 'History', 'English Language', 'Mathematics', 'Science', 'Ghanian Language', 'Creative Arts & Design'],
      'Basic 4': ['Mathematics', 'English Language', 'Science', 'Computing', 'Creative Arts & Design', 'Religious and Moral Education', 'Ghanian Language', 'Physical education', 'French'],
      'Basic 5': ['Mathematics', 'English Language', 'Science', 'Computing', 'Creative Arts & Design', 'Religious and Moral Education', 'Ghanian Language', 'Physical education', 'French'],
      'Basic 6': ['Mathematics', 'English Language', 'Science', 'Computing', 'Creative Arts & Design', 'Religious and Moral Education', 'Ghanian Language', 'Physical education', 'French'],
      'Basic 7': ['Mathematics', 'English Language', 'Science', 'Social studies', 'Computing', 'Career Technology', 'Creative Arts & Design', 'Religious and Moral Education', 'Ghanian Language', 'Physical education', 'French'],
      'Basic 8': ['Mathematics', 'English Language', 'Science', 'Social studies', 'Computing', 'Career Technology', 'Creative Arts & Design', 'Religious and Moral Education', 'Ghanian Language', 'Physical education', 'French'],
      'Basic 9': ['Mathematics', 'English Language', 'Science', 'Social studies', 'Computing', 'Career Technology', 'Creative Arts & Design', 'Religious and Moral Education', 'Ghanian Language', 'Physical education', 'French']
    };

    document.getElementById('class').addEventListener('change', function() {
      const classValue = this.value;
      const subjectSelect = document.getElementById('subject');
      subjectSelect.innerHTML = '<option value="">Select Subject</option>';
      if (classValue && SUBJECTS_BY_CLASS[classValue]) {
        SUBJECTS_BY_CLASS[classValue].forEach(subject => {
          const option = document.createElement('option');
          option.value = subject;
          option.textContent = subject;
          subjectSelect.appendChild(option);
        });
      }
    });

    const loader = document.getElementById('loader');
    function showLoader() { loader.style.display = 'block'; }
    function hideLoader() { loader.style.display = 'none'; }

    async function generateAIPlan(payload) {
      try {
        const response = await fetch("https://lesson-plan-on-render.onrender.com/generate", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`Backend Error: ${response.status} - ${errorText}`);
        }
        return await response.json();
      } catch (e) {
        console.error("AI Request Failed:", e);
        throw new Error("Could not reach your backend. Check the network connection or ensure the Render server is healthy.");
      }
    }

    async function generateLessonPlan() {
      const v = id => document.getElementById(id).value;
      const weekNum = v('weekNum');
      if (!weekNum) {
        alert("Please select a week number.");
        return;
      }
      const rawClass = v('class') || 'B7';
      const classNum = rawClass.match(/\d+/);
      const basicClass = classNum ? `BASIC ${classNum[0]}` : 'BASIC 7';

      // Populate output fields
      document.getElementById('outputClass').textContent = basicClass;
      document.getElementById('outputWeekNum').textContent = weekNum;
      document.getElementById('outputClassSize').textContent = v('classSize');
      document.getElementById('outputDuration').textContent = v('duration');
      document.getElementById('outputLessonTitle').textContent = v('lessonTitle');
      document.getElementById('outputDate').textContent = v('date');
      document.getElementById('outputWeekEnding').textContent = v('weekEnding') || "Not specified"; // ‚úÖ Week Ending
      document.getElementById('outputReferences').textContent = v('references');
      document.getElementById('outputStrand').textContent = v('strand');
      document.getElementById('outputSubStrand').textContent = v('subStrand');
      document.getElementById('outputContentStandard').textContent = v('contentStandard');
      document.getElementById('outputIndicator').textContent = v('indicator');
      document.getElementById('outputPerformanceIndicator').textContent = v('performanceIndicator');
      document.getElementById('outputCoreCompetencies').textContent = v('coreCompetencies');
      document.getElementById('outputTlrs').textContent = v('tlrs');
      const dayValue = v('day') || 'Not specified';
      document.getElementById('outputDayInHeader').textContent = dayValue;
      document.getElementById('outputDayInTable').textContent = dayValue;
      const district = v('district') || "WEEKLY LESSON PLAN";
      document.getElementById('outputDistrictHeader').textContent = district;

      const durationMatch = v('duration').match(/\d+/);
      const totalDuration = durationMatch ? parseInt(durationMatch[0]) : 40;
      const payload = {
        class_level: basicClass,
        lesson: v('lessonTitle') || "Not specified",
        strand: v('strand'),
        content_standard: v('contentStandard'),
        performance_indicator: v('performanceIndicator'),
        exemplars: v('exemplars'),
        tlrs: v('tlrs'),
        duration: totalDuration,
        subject: v('subject') || "Science",
        keywords: v('keywords')
      };

      showLoader();
      try {
        const aiData = await generateAIPlan(payload);

        if (aiData.phase1 && aiData.phase2 && aiData.phase3) {
          const phase1Content = typeof aiData.phase1 === "object"
            ? Object.values(aiData.phase1).join("<br>")
            : aiData.phase1;

          function renderList(list, tag = 'ol') {
            if (!list?.length) return '';
            let html = `<${tag} style="padding-left:20px;margin:5px 0;">`;
            list.forEach(item => {
              if (typeof item === 'string') {
                html += `<li style="margin-bottom:4px;">${item}</li>`;
              } else if (item && typeof item === 'object') {
                const keys = Object.keys(item);
                if (keys.length) {
                  const k = keys[0];
                  html += `<li style="margin-bottom:4px;"><strong>${k}</strong>: ${item[k]}</li>`;
                }
              }
            });
            html += `</${tag}>`;
            return html;
          }

          function renderStructuredPhase2(data) {
            if (!data || typeof data !== 'object') return '';
            let html = '';
            if (data.activities?.length) html += renderList(data.activities, 'ol');
            if (data.content && typeof data.content === 'object') {
              for (const title in data.content) {
                html += `<div style="font-weight:bold;margin:12px 0 4px;text-decoration:underline;">${title}</div>`;
                const items = data.content[title];
                if (Array.isArray(items)) html += renderList(items, 'ul');
                else if (typeof items === 'string') html += `<p style="margin-left:20px;">${items}</p>`;
              }
            }
            if (data.assessment?.length) {
              html += `<div style="font-weight:bolder;font-size:1.1em;margin:16px 0 6px;border-bottom:2px solid #000;display:inline-block;">ASSESSMENT</div>`;
              html += renderList(data.assessment, 'ol');
            }
            return html;
          }

          // ‚úÖ FIXED: Use \n not /
          const finalPhase1 = phase1Content.toString().replace(/\n/g, '<br>');
          const finalMain = renderStructuredPhase2(aiData.phase2);
          const finalReflection = (typeof aiData.phase3 === 'object'
            ? Object.values(aiData.phase3).join('<br>')
            : aiData.phase3 || '').replace(/\n/g, '<br>');

          document.getElementById('outputStarter').innerHTML = finalPhase1;
          document.getElementById('outputMainActivities').innerHTML = finalMain;
          document.getElementById('outputReflection').innerHTML = finalReflection;

        } else if (aiData.content) {
          // ‚úÖ FIXED: Use \n not /
          document.getElementById('outputMainActivities').innerHTML = aiData.content.replace(/\n/g, '<br>');
        } else {
          throw new Error("AI returned an unreadable format.");
        }

      } catch (e) {
        alert(e.message);
        console.error(e);
      } finally {
        hideLoader();
        document.getElementById('lessonPlanOutput').style.display = 'block';
      }
    }

    function printPlan() {
      if (document.getElementById('lessonPlanOutput').style.display === 'none') {
        alert("Please click 'Generate Plan' first.");
        return;
      }
      window.print();
    }

    // ‚úÖ FIXED: NO DYNAMIC LOADING ‚Äî html2pdf is pre-loaded
    function downloadAsPDF() {
      if (document.getElementById('lessonPlanOutput').style.display === 'none') {
        alert("Please click 'Generate Plan' first.");
        return;
      }

      const element = document.getElementById('lessonPlanOutput');
      const classText = document.getElementById('outputClass').textContent.replace(/\s+/g, '');
      const subjectText = document.getElementById('subject').value.replace(/[^a-zA-Z0-9]/g, '') || 'Subject';
      const weekText = document.getElementById('outputWeekNum').textContent || '1';
      const filename = `${classText}_${subjectText}_Week${weekText}.pdf`;

      const opt = {
        margin: 5,
        filename: filename,
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2, useCORS: true, logging: false },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
      };

      html2pdf().from(element).set(opt).save();
    }

    function savePlan() {
      const data = {};
      ['class', 'subject', 'day', 'date', 'weekEnding', 'weekNum', 'lessonTitle', 'period', 'classSize', 'duration',
       'strand', 'subStrand', 'contentStandard', 'indicator', 'performanceIndicator', 'coreCompetencies',
       'keywords', 'exemplars', 'tlrs', 'references', 'district'].forEach(id => {
        data[id] = document.getElementById(id).value;
      });
      localStorage.setItem('klintSavedPlan', JSON.stringify(data));
      alert("‚úÖ Lesson plan saved!");
    }

    function loadLastPlan() {
      const saved = localStorage.getItem('klintSavedPlan');
      if (!saved) {
        alert("‚ùå No saved plan found.");
        return;
      }
      const data = JSON.parse(saved);
      Object.keys(data).forEach(id => {
        const el = document.getElementById(id);
        if (el) el.value = data[id];
      });
      alert("‚úÖ Last plan loaded!");
    }

    function clearForm() {
      if (confirm("Clear all fields?")) {
        document.querySelectorAll('input, select, textarea').forEach(el => {
          if (el.tagName === 'SELECT') el.selectedIndex = 0;
          else el.value = '';
        });
        document.getElementById('lessonPlanOutput').style.display = 'none';
      }
    }
  </script>
</body>
</html>